import React, { useState, useEffect } from 'react';
import { Search, MapPin, Clock, Phone, ArrowLeft, ShoppingBag, Coffee, Pill, LayoutGrid, Star, PersonStanding, Car, Bike, MessageCircle, ChefHat, Sparkles, Loader, Image as ImageIcon, Navigation } from 'lucide-react';

// --- CONFIGURACIÓN GEMINI API ---
const callGemini = async (prompt, systemInstruction = "") => {
  const apiKey = ""; // La clave se inyecta automáticamente en el entorno
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          systemInstruction: { parts: [{ text: systemInstruction }] }
        })
      }
    );
    
    if (!response.ok) {
      throw new Error('Error en la respuesta de Gemini');
    }
    
    const data = await response.json();
    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Lo siento, no pude procesar eso.";
  } catch (error) {
    console.error("Error llamando a Gemini:", error);
    return "Tuve un pequeño problema de conexión. ¿Podrías intentarlo de nuevo?";
  }
};

// --- Mock Data (Datos de ejemplo) ---
const CATEGORIES = [
  { id: 1, name: 'Restaurantes', icon: <ChefHat size={20} /> },
  { id: 2, name: 'Supermercados', icon: <ShoppingBag size={20} /> },
  { id: 3, name: 'Cafés', icon: <Coffee size={20} /> },
  { id: 4, name: 'Droguerías', icon: <Pill size={20} /> },
  { id: 5, name: 'Otros', icon: <LayoutGrid size={20} /> },
];

const BUSINESSES = [
  {
    id: 101,
    name: "La Trattoria del Barrio",
    category: "Restaurantes",
    specialty: "Comida Italiana & Pastas Artesanales",
    deliveryTime: "30-45 min",
    image: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=800&q=80",
    logo: "https://images.unsplash.com/photo-1559339352-11d035aa65de?w=100&q=80",
    hours: "11:00 AM - 10:00 PM",
    status: "open",
    distances: { walk: "5 min", car: "2 min", bike: "3 min" },
    keywords: ["Italiana", "Pasta", "Vino"],
    description: "La mejor pasta artesanal hecha en casa con ingredientes frescos.",
    gallery: [
      "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=600&q=80",
      "https://images.unsplash.com/photo-1574071318500-d0d586aa477d?w=600&q=80",
      "https://images.unsplash.com/photo-1612874742237-6526221588e3?w=600&q=80",
      "https://images.unsplash.com/photo-1595295333158-4742f28fbd85?w=600&q=80",
      "https://images.unsplash.com/photo-1551183053-bf91a1d81141?w=600&q=80",
      "https://images.unsplash.com/photo-1550966871-3ed3c47e2ce2?w=600&q=80",
    ]
  },
  {
    id: 102,
    name: "Café El Despertar",
    category: "Cafés",
    specialty: "Café de Origen & Repostería",
    deliveryTime: "15-25 min",
    image: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=800&q=80",
    logo: "https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=100&q=80",
    hours: "07:00 AM - 08:00 PM",
    status: "closing",
    distances: { walk: "12 min", car: "5 min", bike: "6 min" },
    keywords: ["Café", "Postres", "Wifi"],
    description: "Un espacio tranquilo para trabajar y disfrutar del mejor café de la región.",
    gallery: [
       "https://images.unsplash.com/photo-1497935586351-b67a49e012bf?w=600&q=80",
       "https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=600&q=80",
       "https://images.unsplash.com/photo-1517231925375-bf2cb42917a5?w=600&q=80",
       "https://images.unsplash.com/photo-1579372786545-d24232daf58c?w=600&q=80",
    ]
  },
  {
    id: 103,
    name: "Supermercado La Esquina",
    category: "Supermercados",
    specialty: "Abarrotes, Licores & Aseo",
    deliveryTime: "40-60 min",
    image: "https://images.unsplash.com/photo-1542838132-92c53300491e?w=800&q=80",
    logo: "https://images.unsplash.com/photo-1542838132-92c53300491e?w=100&q=80",
    hours: "08:00 AM - 09:00 PM",
    status: "closed",
    distances: { walk: "20 min", car: "8 min", bike: "10 min" },
    keywords: ["Víveres", "Licores", "Aseo"],
    description: "Todo lo que necesitas para tu hogar a los mejores precios.",
    gallery: [
       "https://images.unsplash.com/photo-1604719312566-b76d4686ed52?w=600&q=80",
       "https://images.unsplash.com/photo-1583258292688-d0213dc5a3a8?w=600&q=80",
       "https://images.unsplash.com/photo-1625702463365-44a36c525d44?w=600&q=80",
    ]
  },
  {
    id: 104,
    name: "Burger Kingo",
    category: "Restaurantes",
    specialty: "Hamburguesas al Carbón",
    deliveryTime: "25-35 min",
    image: "https://images.unsplash.com/photo-1571091718767-18b5b1457add?w=800&q=80",
    logo: "https://images.unsplash.com/photo-1571091718767-18b5b1457add?w=100&q=80",
    hours: "12:00 PM - 11:00 PM",
    status: "open",
    distances: { walk: "8 min", car: "3 min", bike: "4 min" },
    keywords: ["Hamburguesa", "Rápida", "Queso"],
    description: "Las hamburguesas más grandes del barrio.",
    gallery: [
       "https://images.unsplash.com/photo-1550547660-d9450f859349?w=600&q=80",
       "https://images.unsplash.com/photo-1594212699903-ec8a3eca50f5?w=600&q=80",
       "https://images.unsplash.com/photo-1552566626-52f8b828add9?w=600&q=80",
       "https://images.unsplash.com/photo-1521305916504-4a1121188589?w=600&q=80",
    ]
  }
];

// --- Componente Principal ---

export default function TerrarioApp() {
  const [currentView, setCurrentView] = useState('home'); 
  const [selectedBusiness, setSelectedBusiness] = useState(null);
  
  useEffect(() => {
    const link = document.createElement('link');
    link.href = 'https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap';
    link.rel = 'stylesheet';
    document.head.appendChild(link);
  }, []);

  const handleBusinessClick = (business) => {
    setSelectedBusiness(business);
    setCurrentView('card');
  };

  const handleSeeGallery = () => {
    setCurrentView('restaurant');
  };

  const goBack = () => {
    if (currentView === 'restaurant') {
      setCurrentView('card');
    } else {
      setCurrentView('home');
      setSelectedBusiness(null);
    }
  };

  const openGoogleMaps = (businessName) => {
    const query = encodeURIComponent(businessName);
    window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
  };

  // --- VISTA: INICIO ---
  const HomeView = () => (
    <div className="flex flex-col pb-20 animate-fadeIn relative min-h-screen w-full">
      {/* Header + Buscador */}
      <header className="bg-white p-4 sticky top-0 z-20 shadow-sm">
        <div className="flex items-center justify-between mb-4">
          <div className="flex items-center gap-2">
            {/* LOGO EN CABECERA */}
            <div className="w-10 h-10 bg-[#193f3f] rounded-full flex items-center justify-center text-white overflow-hidden p-1.5">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" width="100%" height="100%" fill="currentColor">
                    <g>
                        <path d="M278.65,390.79c-.99,0-1.97-.02-2.97-.06l-5.8-.25.25-5.8c.78-18.31,8.65-35.21,22.14-47.6,13.5-12.39,31-18.82,49.32-18l5.8.25-.25,5.8c-1.57,36.79-32.01,65.67-68.5,65.67ZM334.97,330.73c-12.95.82-25.14,5.99-34.84,14.89-9.7,8.9-15.89,20.61-17.81,33.44,26.64-1.71,48.67-21.94,52.65-48.33Z"/>
                        <path d="M270.4,452.78c-35.93,0-66.2-28.08-68.42-64.41l-.35-5.79,5.79-.35c37.77-2.37,70.35,26.53,72.65,64.28l.35,5.79-5.79.35c-1.42.09-2.83.13-4.23.13ZM214.25,393.76c2.16,12.8,8.57,24.39,18.43,33.11,9.86,8.72,22.14,13.67,35.11,14.25-4.47-26.32-26.87-46.13-53.53-47.36Z"/>
                        <rect x="270.13" y="384.99" width="11.6" height="142.42"/>
                    </g>
                    <g>
                        <path d="M720.99,390.79c-36.49,0-66.92-28.87-68.5-65.67l-.25-5.8,5.8-.25c18.29-.8,35.82,5.61,49.32,18,13.5,12.39,21.36,29.3,22.14,47.6l.25,5.8-5.8.25c-.99.04-1.98.06-2.97.06ZM664.68,330.73c3.98,26.4,26.01,46.62,52.65,48.33-1.92-12.84-8.12-24.54-17.81-33.44-9.7-8.9-21.89-14.08-34.84-14.89Z"/>
                        <path d="M729.3,452.78c-1.42,0-2.85-.04-4.28-.13l-5.79-.35.35-5.79c2.31-37.75,34.91-66.62,72.65-64.28l5.79.35-.35,5.79c-1.12,18.29-9.29,35.05-23.01,47.19-12.65,11.19-28.62,17.23-45.36,17.23ZM785.39,393.75c-12.97.58-25.25,5.53-35.11,14.25-9.86,8.72-16.27,20.31-18.42,33.11,12.97-.58,25.25-5.53,35.11-14.25,9.86-8.72,16.27-20.31,18.42-33.11Z"/>
                        <rect x="717.91" y="384.99" width="11.6" height="144.28"/>
                    </g>
                    <g>
                        <path d="M389.67,426.78l-2.97-4.99c-12.66-21.25-5.66-48.83,15.59-61.48l4.98-2.97,2.97,4.99c6.13,10.29,7.88,22.36,4.94,33.97-2.94,11.61-10.23,21.38-20.53,27.51l-4.98,2.97ZM403.03,374.09c-10.01,8.98-13.63,23.27-9.11,35.93,4.89-4.37,8.37-10.09,10.01-16.58,1.65-6.49,1.31-13.18-.9-19.35Z"/>
                        <path d="M371.62,430.24c-3.7,0-7.42-.46-11.1-1.4-11.61-2.94-21.38-10.23-27.51-20.53l-2.97-4.98,4.99-2.97c10.29-6.13,22.36-7.88,33.97-4.94,11.61,2.94,21.38,10.23,27.51,20.53l2.97,4.98-4.99,2.97c-7.03,4.19-14.89,6.34-22.87,6.34ZM346.78,407.58c4.37,4.89,10.09,8.37,16.58,10.02,6.49,1.64,13.18,1.31,19.35-.91-4.37-4.89-10.09-8.37-16.58-10.02-6.5-1.65-13.19-1.31-19.35.91Z"/>
                        <path d="M375.96,480.46l-2.97-4.99c-6.13-10.29-7.89-22.36-4.94-33.97,2.94-11.61,10.23-21.38,20.53-27.51l4.98-2.97,2.97,4.99c12.65,21.25,5.66,48.83-15.59,61.48l-4.98,2.97ZM389.31,427.78c-4.89,4.37-8.37,10.09-10.01,16.58-1.65,6.49-1.31,13.18.91,19.35,10.01-8.98,13.63-23.26,9.11-35.93Z"/>
                        <path d="M425.35,443.76c-3.7,0-7.42-.46-11.1-1.39-11.61-2.94-21.38-10.23-27.51-20.53l-2.97-4.98,4.99-2.97c21.25-12.66,48.83-5.66,61.48,15.59l2.97,4.98-4.99,2.97c-7.03,4.19-14.89,6.33-22.87,6.33ZM400.52,421.11c4.37,4.89,10.09,8.37,16.58,10.01,6.49,1.65,13.18,1.31,19.35-.9-8.98-10.01-23.27-13.63-35.93-9.11Z"/>
                    </g>
                    <g>
                        <path d="M612.02,426.78l-4.98-2.97c-10.29-6.13-17.58-15.9-20.53-27.51-2.94-11.61-1.19-23.68,4.94-33.97l2.97-4.99,4.98,2.97c21.25,12.66,28.24,40.24,15.58,61.48l-2.97,4.99ZM598.66,374.09c-2.22,6.17-2.55,12.85-.91,19.35,1.65,6.49,5.13,12.21,10.01,16.58,4.53-12.66.9-26.95-9.1-35.93Z"/>
                        <path d="M630.07,430.21c-7.8,0-15.7-2.03-22.87-6.31l-4.99-2.97,2.97-4.98c6.13-10.29,15.9-17.58,27.51-20.53,11.62-2.94,23.68-1.19,33.97,4.94l4.99,2.97-2.97,4.98c-8.38,14.07-23.31,21.89-38.61,21.89ZM618.97,416.69c12.66,4.53,26.95.91,35.93-9.11-6.17-2.22-12.86-2.56-19.35-.9-6.49,1.65-12.21,5.13-16.58,10.01Z"/>
                        <path d="M625.72,480.46l-4.98-2.97c-21.25-12.66-28.24-40.24-15.59-61.48l2.97-4.99,4.99,2.97c10.29,6.13,17.58,15.9,20.53,27.51,2.94,11.61,1.19,23.68-4.94,33.97l-2.97,4.99ZM612.38,427.78c-4.53,12.66-.9,26.95,9.1,35.93,2.22-6.17,2.55-12.85.91-19.35-1.65-6.49-5.13-12.21-10.01-16.58Z"/>
                        <path d="M576.34,443.76c-7.98,0-15.84-2.15-22.87-6.33l-4.99-2.97,2.97-4.98c12.65-21.25,40.23-28.25,61.48-15.59l4.99,2.97-2.97,4.98c-6.13,10.29-15.9,17.58-27.51,20.53-3.68.93-7.4,1.39-11.1,1.39ZM565.24,430.22c6.17,2.21,12.85,2.55,19.35.9,6.49-1.65,12.21-5.13,16.58-10.01-12.66-4.53-26.95-.91-35.93,9.11Z"/>
                    </g>
                    <g>
                        <path d="M499.42,344.95c-42.74,0-77.5-34.77-77.5-77.5s34.77-77.5,77.5-77.5,77.5,34.77,77.5-77.5-34.77,77.5-77.5,77.5ZM499.42,201.54c-36.34,0-65.9,29.56-65.9,65.9s29.56,65.9,65.9,65.9,65.9-29.56,65.9-65.9-29.56-65.9-65.9-65.9Z"/>
                        <path d="M499.58,201.54c-3.2,0-5.8-2.6-5.8-5.8v-61.93c0-3.2,2.6-5.8,5.8-5.8s5.8,2.6,5.8,5.8v61.93c0,3.2-2.6,5.8-5.8,5.8Z"/>
                        <path d="M552.56,223.44c-1.49,0-2.97-.57-4.1-1.7-2.27-2.27-2.27-5.94,0-8.21l43.79-43.79c2.27-2.27,5.94-2.27,8.21,0,2.27,2.27,2.27,5.94,0,8.21l-43.79,43.79c-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                        <path d="M444.48,223.44c-1.49,0-2.97-.57-4.1-1.7l-43.79-43.79c-2.27-2.27-2.27-5.94,0-8.21,2.27-2.27,5.94-2.27,8.21,0l43.79,43.79c2.27,2.27,2.27,5.94,0,8.21-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                        <path d="M383.15,162.12c-1.49,0-2.97-.57-4.1-1.7l-4.36-4.36c-2.27-2.27-2.27-5.94,0-8.2,2.27-2.27,5.94-2.27,8.2,0l4.36,4.36c2.27,2.27,2.27,5.94,0,8.2-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                        <path d="M613.42,162.12c-1.49,0-2.97-.57-4.1-1.7-2.27-2.27-2.27-5.94,0-8.2l4.36-4.36c2.27-2.27,5.94-2.27,8.2,0,2.27,2.27,2.27,5.94,0,8.2l-4.36,4.36c-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                        <path d="M470.42,205.38c-2.24,0-4.37-1.3-5.32-3.48l-15.33-35.02c-1.28-2.93.05-6.36,2.99-7.64,2.94-1.28,6.36.05,7.64,2.99l15.33,35.02c1.28,2.93-.05,6.36-2.99,7.64-.76.33-1.55.49-2.32.49Z"/>
                        <path d="M530.74,205.68c-.7,0-1.42-.13-2.11-.4-2.98-1.17-4.46-4.53-3.29-7.52l13.92-35.6c1.17-2.98,4.53-4.46,7.52-3.29,2.98,1.17,4.46,4.53,3.29,7.52l-13.92,35.6c-.9,2.29-3.09,3.69-5.41,3.69Z"/>
                        <path d="M555.62,142.63c-.7,0-1.42-.13-2.11-.4-2.98-1.17-4.46-4.53-3.29-7.52l1.8-4.59c1.17-2.98,4.53-4.46,7.52-3.29,2.98,1.17,4.46,4.53,3.29,7.52l-1.8,4.59c-.9,2.29-3.09,3.69-5.41,3.69Z"/>
                        <path d="M444.48,142.63c-2.32,0-4.51-1.4-5.41-3.69l-1.8-4.59c-1.17-2.98.31-6.35,3.29-7.52,2.98-1.16,6.35.31,7.52,3.29l1.8,4.59c1.17,2.98-.31,6.35-3.29,7.52-.69.27-1.41.4-2.11.4Z"/>
                        <path d="M570.05,249.87c-2.15,0-4.21-1.2-5.22-3.26-1.41-2.88-.21-6.35,2.67-7.76l34.36-16.76c2.87-1.41,6.35-.21,7.76,2.67,1.41,2.88.21,6.35-2.67,7.76l-34.36,16.76c-.82.4-1.69.59-2.54.59Z"/>
                        <path d="M429.49,249.87c-.85,0-1.72-.19-2.54-.59l-34.36-16.76c-2.88-1.41-4.07-4.88-2.67-7.76,1.4-2.88,4.88-4.08,7.76-2.67l34.36,16.76c2.88,1.41,4.07,4.88,2.67,7.76-1,2.06-3.07,3.26-5.22,3.26Z"/>
                        <path d="M636.38,277.24h-61.93c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h61.93c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                        <path d="M422.58,277.24h-61.93c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h61.93c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                        <path d="M499.42,113.82c-3.2,0-5.8-2.6-5.8-5.8v-5.69c0-3.2,2.6-5.8,5.8-5.8s5.8,2.6,5.8,5.8v5.69c0,3.2-2.6,5.8-5.8,5.8Z"/>
                        <path d="M336.11,277.24h-5.69c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h5.69c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                        <path d="M667.34,277.24h-5.69c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h5.69c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                        <path d="M365.76,219.31c-.85,0-1.72-.19-2.54-.59l-5.11-2.49c-2.88-1.41-4.08-4.88-2.67-7.76,1.41-2.88,4.88-4.07,7.76-2.67l5.11,2.49c2.88,1.41,4.08,4.88,2.67,7.76-1.01,2.06-3.07,3.26-5.22,3.26Z"/>
                        <path d="M629.85,223.44c-2.15,0-4.22-1.2-5.22-3.26-1.4-2.88-.21-6.35,2.67-7.76l5.11-2.49c2.88-1.41,6.35-.21,7.76,2.67,1.4,2.88.21,6.35-2.67,7.76l-5.11,2.49c-.82.4-1.69.59-2.54.59Z"/>
                    </g>
                </svg>
            </div>
            {/* CAMBIO: Nombre actualizado a Directorio Terrario */}
            <span className="font-bold text-xl text-[#193f3f]">Directorio Terrario</span>
          </div>
        </div>
        
        <div className="relative">
          <input 
            type="text" 
            placeholder="¿Qué quieres buscar hoy?" 
            className="w-full bg-gray-100 py-3 pl-10 pr-4 rounded-2xl outline-none focus:ring-2 focus:ring-[#193f3f] text-sm text-gray-700"
          />
          <Search className="absolute left-3 top-3 text-gray-400 w-5 h-5" />
        </div>
      </header>

      {/* Banner */}
      <div className="px-4 mb-6 mt-2">
        <div className="bg-gradient-to-r from-[#193f3f] to-[#255050] rounded-2xl p-6 text-white shadow-lg relative overflow-hidden">
          <div className="relative z-10">
            {/* CAMBIO: text-3xl para más tamaño */}
            <h2 className="text-3xl font-bold mb-1">Bienvenido/a a Terrario</h2>
            {/* CAMBIO: font-medium para quitar negrita (menos peso) */}
            <p className="text-[#a8babb] text-2xl mb-4 font-medium">Las Acacias</p>
            {/* CAMBIO: Texto de búsqueda actualizado */}
            <p className="font-medium text-lg">Encuentra aquí todo lo que necesitas</p>
          </div>
          
          {/* NUEVO ICONO PERSONALIZADO (SVG GRANDE CORTADO) - Posicionado más a la derecha */}
          <div className="absolute right-0 bottom-0 opacity-20 pointer-events-none transform translate-y-10 translate-x-12">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000" width="220" height="220">
              <g>
                <path fill="#fff" d="M278.65,390.79c-.99,0-1.97-.02-2.97-.06l-5.8-.25.25-5.8c.78-18.31,8.65-35.21,22.14-47.6,13.5-12.39,31-18.82,49.32-18l5.8.25-.25,5.8c-1.57,36.79-32.01,65.67-68.5,65.67ZM334.97,330.73c-12.95.82-25.14,5.99-34.84,14.89-9.7,8.9-15.89,20.61-17.81,33.44,26.64-1.71,48.67-21.94,52.65-48.33Z"/>
                <path fill="#fff" d="M270.4,452.78c-35.93,0-66.2-28.08-68.42-64.41l-.35-5.79,5.79-.35c37.77-2.37,70.35,26.53,72.65,64.28l.35,5.79-5.79.35c-1.42.09-2.83.13-4.23.13ZM214.25,393.76c2.16,12.8,8.57,24.39,18.43,33.11,9.86,8.72,22.14,13.67,35.11,14.25-4.47-26.32-26.87-46.13-53.53-47.36Z"/>
                <rect fill="#fff" x="270.13" y="384.99" width="11.6" height="142.42"/>
              </g>
              <g>
                <path fill="#fff" d="M720.99,390.79c-36.49,0-66.92-28.87-68.5-65.67l-.25-5.8,5.8-.25c18.29-.8,35.82,5.61,49.32,18,13.5,12.39,21.36,29.3,22.14,47.6l.25,5.8-5.8.25c-.99.04-1.98.06-2.97.06ZM664.68,330.73c3.98,26.4,26.01,46.62,52.65,48.33-1.92-12.84-8.12-24.54-17.81-33.44-9.7-8.9-21.89-14.08-34.84-14.89Z"/>
                <path fill="#fff" d="M729.3,452.78c-1.42,0-2.85-.04-4.28-.13l-5.79-.35.35-5.79c2.31-37.75,34.91-66.62,72.65-64.28l5.79.35-.35,5.79c-1.12,18.29-9.29,35.05-23.01,47.19-12.65,11.19-28.62,17.23-45.36,17.23ZM785.39,393.75c-12.97.58-25.25,5.53-35.11,14.25-9.86,8.72-16.27,20.31-18.42-33.11,12.97-.58,25.25-5.53,35.11-14.25,9.86-8.72,16.27-20.31,18.42-33.11Z"/>
                <rect fill="#fff" x="717.91" y="384.99" width="11.6" height="144.28"/>
              </g>
              <g>
                <path fill="#fff" d="M389.67,426.78l-2.97-4.99c-12.66-21.25-5.66-48.83,15.59-61.48l4.98-2.97,2.97,4.99c6.13,10.29,7.88,22.36,4.94,33.97-2.94,11.61-10.23,21.38-20.53,27.51l-4.98,2.97ZM403.03,374.09c-10.01,8.98-13.63,23.27-9.11,35.93,4.89-4.37,8.37-10.09,10.01-16.58,1.65-6.49,1.31-13.18-.9-19.35Z"/>
                <path fill="#fff" d="M371.62,430.24c-3.7,0-7.42-.46-11.1-1.4-11.61-2.94-21.38-10.23-27.51-20.53l-2.97-4.98,4.99-2.97c10.29-6.13,22.36-7.88,33.97-4.94,11.61,2.94,21.38,10.23,27.51,20.53l2.97,4.98-4.99,2.97c-7.03,4.19-14.89,6.34-22.87,6.34ZM346.78,407.58c4.37,4.89,10.09,8.37,16.58,10.02,6.49,1.64,13.18,1.31,19.35-.91-4.37-4.89-10.09-8.37-16.58-10.02-6.5-1.65-13.19-1.31-19.35.91Z"/>
                <path fill="#fff" d="M375.96,480.46l-2.97-4.99c-6.13-10.29-7.89-22.36-4.94-33.97,2.94-11.61,10.23-21.38,20.53-27.51l4.98-2.97,2.97,4.99c12.65,21.25,5.66,48.83-15.59,61.48l-4.98,2.97ZM389.31,427.78c-4.89,4.37-8.37,10.09-10.01,16.58-1.65,6.49-1.31,13.18.91,19.35,10.01-8.98,13.63-23.26,9.11-35.93Z"/>
                <path fill="#fff" d="M425.35,443.76c-3.7,0-7.42-.46-11.1-1.39-11.61-2.94-21.38-10.23-27.51-20.53l-2.97-4.98,4.99-2.97c21.25-12.66,48.83-5.66,61.48,15.59l2.97,4.98-4.99,2.97c-7.03,4.19-14.89,6.33-22.87,6.33ZM400.52,421.11c4.37,4.89,10.09,8.37,16.58,10.01,6.49,1.65,13.18,1.31,19.35-.9-8.98-10.01-23.27-13.63-35.93-9.11Z"/>
              </g>
              <g>
                <path fill="#fff" d="M612.02,426.78l-4.98-2.97c-10.29-6.13-17.58-15.9-20.53-27.51-2.94-11.61-1.19-23.68,4.94-33.97l2.97-4.99,4.98,2.97c21.25,12.66,28.24,40.24,15.58,61.48l-2.97,4.99ZM598.66,374.09c-2.22,6.17-2.55,12.85-.91,19.35,1.65,6.49,5.13,12.21,10.01,16.58,4.53-12.66.9-26.95-9.1-35.93Z"/>
                <path fill="#fff" d="M630.07,430.21c-7.8,0-15.7-2.03-22.87-6.31l-4.99-2.97,2.97-4.98c6.13-10.29,15.9-17.58,27.51-20.53,11.62-2.94,23.68-1.19,33.97,4.94l4.99,2.97-2.97,4.98c-8.38,14.07-23.31,21.89-38.61,21.89ZM618.97,416.69c12.66,4.53,26.95.91,35.93-9.11-6.17-2.22-12.86-2.56-19.35-.9-6.49,1.65-12.21,5.13-16.58,10.01Z"/>
                <path fill="#fff" d="M625.72,480.46l-4.98-2.97c-21.25-12.66-28.24-40.24-15.59-61.48l2.97-4.99,4.99,2.97c10.29,6.13,17.58,15.9,20.53,27.51,2.94,11.61,1.19,23.68-4.94,33.97l-2.97,4.99ZM612.38,427.78c-4.53,12.66-.9,26.95,9.1,35.93,2.22-6.17,2.55-12.85.91-19.35-1.65-6.49-5.13-12.21-10.01-16.58Z"/>
                <path fill="#fff" d="M576.34,443.76c-7.98,0-15.84-2.15-22.87-6.33l-4.99-2.97,2.97-4.98c12.65-21.25,40.23-28.25,61.48-15.59l4.99,2.97-2.97,4.98c-6.13,10.29-15.9,17.58-27.51,20.53-3.68.93-7.4,1.39-11.1,1.39ZM565.24,430.22c6.17,2.21,12.85,2.55,19.35.9,6.49-1.65,12.21-5.13,16.58-10.01-12.66-4.53-26.95-.91-35.93,9.11Z"/>
              </g>
              <g>
                <path fill="#fff" d="M499.42,344.95c-42.74,0-77.5-34.77-77.5-77.5s34.77-77.5,77.5-77.5,77.5,34.77,77.5-77.5-34.77,77.5-77.5,77.5ZM499.42,201.54c-36.34,0-65.9,29.56-65.9,65.9s29.56,65.9,65.9,65.9,65.9-29.56,65.9-65.9-29.56-65.9-65.9-65.9Z"/>
                <path fill="#fff" d="M499.58,201.54c-3.2,0-5.8-2.6-5.8-5.8v-61.93c0-3.2,2.6-5.8,5.8-5.8s5.8,2.6,5.8,5.8v61.93c0,3.2-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M552.56,223.44c-1.49,0-2.97-.57-4.1-1.7-2.27-2.27-2.27-5.94,0-8.21l43.79-43.79c2.27-2.27,5.94-2.27,8.21,0,2.27,2.27,2.27,5.94,0,8.21l-43.79,43.79c-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                <path fill="#fff" d="M444.48,223.44c-1.49,0-2.97-.57-4.1-1.7l-43.79-43.79c-2.27-2.27-2.27-5.94,0-8.21,2.27-2.27,5.94-2.27,8.21,0l43.79,43.79c2.27,2.27,2.27,5.94,0,8.21-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                <path fill="#fff" d="M383.15,162.12c-1.49,0-2.97-.57-4.1-1.7l-4.36-4.36c-2.27-2.27-2.27-5.94,0-8.2,2.27-2.27,5.94-2.27,8.2,0l4.36,4.36c2.27,2.27,2.27,5.94,0,8.2-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                <path fill="#fff" d="M613.42,162.12c-1.49,0-2.97-.57-4.1-1.7-2.27-2.27-2.27-5.94,0-8.2l4.36-4.36c2.27-2.27,5.94-2.27,8.2,0,2.27,2.27,2.27,5.94,0,8.2l-4.36,4.36c-1.13,1.13-2.62,1.7-4.1,1.7Z"/>
                <path fill="#fff" d="M470.42,205.38c-2.24,0-4.37-1.3-5.32-3.48l-15.33-35.02c-1.28-2.93.05-6.36,2.99-7.64,2.94-1.28,6.36.05,7.64,2.99l15.33,35.02c1.28,2.93-.05,6.36-2.99,7.64-.76.33-1.55.49-2.32.49Z"/>
                <path fill="#fff" d="M530.74,205.68c-.7,0-1.42-.13-2.11-.4-2.98-1.17-4.46-4.53-3.29-7.52l13.92-35.6c1.17-2.98,4.53-4.46,7.52-3.29,2.98,1.17,4.46,4.53,3.29,7.52l-13.92,35.6c-.9,2.29-3.09,3.69-5.41,3.69Z"/>
                <path fill="#fff" d="M555.62,142.63c-.7,0-1.42-.13-2.11-.4-2.98-1.17-4.46-4.53-3.29-7.52l1.8-4.59c1.17-2.98,4.53-4.46,7.52-3.29,2.98,1.17,4.46,4.53,3.29,7.52l-1.8,4.59c-.9,2.29-3.09,3.69-5.41,3.69Z"/>
                <path fill="#fff" d="M444.48,142.63c-2.32,0-4.51-1.4-5.41-3.69l-1.8-4.59c-1.17-2.98.31-6.35,3.29-7.52,2.98-1.16,6.35.31,7.52,3.29l1.8,4.59c1.17,2.98-.31,6.35-3.29,7.52-.69.27-1.41.4-2.11.4Z"/>
                <path fill="#fff" d="M570.05,249.87c-2.15,0-4.21-1.2-5.22-3.26-1.41-2.88-.21-6.35,2.67-7.76l34.36-16.76c2.87-1.41,6.35-.21,7.76,2.67,1.41,2.88.21,6.35-2.67,7.76l-34.36,16.76c-.82.4-1.69.59-2.54.59Z"/>
                <path fill="#fff" d="M429.49,249.87c-.85,0-1.72-.19-2.54-.59l-34.36-16.76c-2.88-1.41-4.07-4.88-2.67-7.76,1.4-2.88,4.88-4.08,7.76-2.67l34.36,16.76c2.88,1.41,4.07,4.88,2.67,7.76-1,2.06-3.07,3.26-5.22,3.26Z"/>
                <path fill="#fff" d="M636.38,277.24h-61.93c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h61.93c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M422.58,277.24h-61.93c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h61.93c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M499.42,113.82c-3.2,0-5.8-2.6-5.8-5.8v-5.69c0-3.2,2.6-5.8,5.8-5.8s5.8,2.6,5.8,5.8v5.69c0,3.2-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M336.11,277.24h-5.69c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h5.69c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M667.34,277.24h-5.69c-3.2,0-5.8-2.6-5.8-5.8s2.6-5.8,5.8-5.8h5.69c3.2,0,5.8,2.6,5.8,5.8s-2.6,5.8-5.8,5.8Z"/>
                <path fill="#fff" d="M365.76,219.31c-.85,0-1.72-.19-2.54-.59l-5.11-2.49c-2.88-1.41-4.08-4.88-2.67-7.76,1.41-2.88,4.88-4.07,7.76-2.67l5.11,2.49c2.88,1.41,4.08,4.88,2.67,7.76-1.01,2.06-3.07,3.26-5.22,3.26Z"/>
                <path fill="#fff" d="M629.85,223.44c-2.15,0-4.22-1.2-5.22-3.26-1.4-2.88-.21-6.35,2.67-7.76l5.11-2.49c2.88-1.41,6.35-.21,7.76,2.67,1.4,2.88.21,6.35-2.67,7.76l-5.11,2.49c-.82.4-1.69.59-2.54.59Z"/>
              </g>
              <rect fill="#fff" x="234.07" y="750.95" width="132.21" height="14.35"/>
              <rect fill="#fff" x="634.71" y="750.95" width="132.21" height="14.35"/>
              <g>
                <path fill="#fff" d="M791.88,515.16c-68.87,0-133.61,26.82-182.31,75.52-26.35,26.35-46.28,57.41-59.04,91.28,4.26-.12,8.52-.28,12.77-.48,35.71-88.86,121.79-152.26,222.7-154.64-2.19,93.19-56.43,173.72-134.7,213.63-2.61,5.88-5.6,11.7-9.11,17.12,91.39-39.68,155.48-130.8,155.48-236.62v-5.8h-5.8Z"/>
                <path fill="#fff" d="M626.04,679.09c5.4-.18,10.83-.42,16.25-.32l148.76-148.76-8.21-8.21-157.3,157.3c.17,0,.33,0,.5-.01Z"/>
                <path fill="#fff" d="M703.66,606.96c-21.24-33.21-7.53-70.07-6.93-71.62l10.84,4.15-5.42-2.07,5.42,2.06c-.12.33-12.16,33.04,5.87,61.23l-9.78,6.25Z"/>
                <path fill="#fff" d="M748.29,620.74c-12.81,0-28.24-2.66-42.87-12.02l6.25-9.78c28.23,18.06,61.45,6.42,61.78,6.3l3.96,10.9c-.88.32-12.9,4.59-29.13,4.59Z"/>
                <path fill="#fff" d="M591.57,680.02c-3.3-25.21.78-50.53.84-50.9l-11.44-1.91c-.27,1.59-4.36,26.97-1.02,53.41,3.88-.21,7.75-.41,11.63-.6Z"/>
                <path fill="#fff" d="M697.88,679.41c-18.25,0-37.85-2.6-51.7-11.45l6.25-9.78c28.76,18.4,91.22,4.83,91.85,4.69l2.51,11.33c-1.59.35-23.98,5.21-48.91,5.21Z"/>
                <path fill="#fff" d="M644.42,666.2c-20.97-32.78-6.86-97.86-6.24-100.61l11.33,2.51c-.14.63-13.68,63.13,4.69,91.85l-9.78,6.25Z"/>
              </g>
              <g>
                <path fill="#fff" d="M352.33,739.96c-77.74-40.08-131.53-120.33-133.72-213.13,101.66,2.39,188.27,66.72,223.49,156.62,4.01-.28,8.01-.63,12.01-1.11-36.76-97.58-131.08-167.19-241.36-167.19h-5.8v5.8c0,104.03,61.93,193.85,150.86,234.57-2.09-5.09-3.73-10.35-5.47-15.57Z"/>
                <path fill="#fff" d="M383.35,683.36l-161.57-161.57-8.21,8.21,152.9,152.9c5.62.11,11.24.27,16.87.46Z"/>
                <path fill="#fff" d="M300.96,606.96l-9.78-6.25c18.03-28.18,5.99-60.9,5.87-61.23l10.84-4.14c.59,1.55,14.31,38.41-6.94,71.62Z"/>
                <path fill="#fff" d="M256.33,620.74c-16.23,0-28.25-4.27-29.13-4.59l3.97-10.9-1.99,5.45,1.98-5.45c.33.12,33.54,11.76,61.78-6.3l6.25,9.78c-14.63,9.36-30.06,12.02-42.87,12.02Z"/>
                <path fill="#fff" d="M412.44,684.16c3.92.05,7.84.05,11.75,0,4.21-27.67-.25-55.3-.53-56.95l-11.44,1.91c.07.39,4.6,28.55.23,55.05Z"/>
                <path fill="#fff" d="M306.74,679.41c-24.94,0-47.32-4.86-48.91-5.21l2.51-11.33c.63.14,63.13,13.68,91.85-4.69l6.25,9.78c-13.85,8.86-33.46,11.45-51.7,11.45Z"/>
                <path fill="#fff" d="M360.2,666.2l-9.78-6.25c18.37-28.72,4.83-91.22,4.69-91.85l11.33-2.51c.61,2.75,14.72,67.83-6.24,100.61Z"/>
              </g>
              <path fill="#fff" d="M331.25,676.14l.61,7.73c3.33,42.44,22.39,81.82,53.67,110.89,13.01,12.1,27.68,21.9,43.42,29.29.18-1.24.38-2.47.63-3.67.7-3.4,1.79-7.11,3.71-10.15-13.75-6.66-26.56-15.36-37.99-25.98-26.73-24.84-43.71-57.9-48.33-93.77h307.95c-4.62,35.88-21.6,68.93-48.33,93.77-11.38,10.58-24.15,19.25-37.84,25.9,1.05,2.71,2.13,5.4,3.07,8.15.62,1.82,1.15,3.66,1.58,5.52,15.56-7.36,30.06-17.09,42.95-29.07,31.28-29.07,50.34-68.45,53.67-110.89l.61-7.73h-339.37Z"/>
              <g>
                <g>
                  <line fill="#fff" x1="498.52" y1="566.72" x2="498.52" y2="683.32"/>
                  <rect fill="#fff" x="492.71" y="566.72" width="11.6" height="109.43"/>
                </g>
                <g>
                  <line fill="#fff" x1="498.52" y1="432.87" x2="498.52" y2="561.77"/>
                  <rect fill="#fff" x="492.71" y="432.87" width="11.6" height="128.89"/>
                </g>
                <g>
                  <line fill="#fff" x1="603.37" y1="513.59" x2="512.23" y2="604.73"/>
                  <rect fill="#fff" x="493.35" y="553.36" width="128.89" height="11.61" transform="translate(-232.01 558.2) rotate(-45)"/>
                </g>
                <g>
                  <line fill="#fff" x1="396.01" y1="513.59" x2="487.15" y2="604.73"/>
                  <rect fill="#fff" x="435.78" y="494.71" width="11.61" height="128.89" transform="translate(-266.05 476.02) rotate(-45)"/>
                </g>
                <g>
                  <path fill="#fff" d="M498.52,435.78c7.05,8.76,12.07,20.02,15.08,32.35l10.24-6.39c-4.22-15.17-11.27-28.8-21.22-38.75l-4.1-4.1-4.1,4.1c-19.35,19.35-27.85,52.57-25.52,84.12l11.78,2.3c-2.66-26.8,3.29-55.54,17.84-73.63Z"/>
                  <path fill="#fff" d="M514.3,471.17c6.47,30.11,1.21,65.74-15.78,86.86-9.68-12.03-15.53-28.76-17.6-46.49l-11.08,4.24c3,21.56,11.18,41.64,24.58,55.04l4.1,4.1,4.1-4.1c22.56-22.57,30.38-64,23.46-99.65h-11.78Z"/>
                </g>
                <g>
                  <path fill="#fff" d="M601.02,515.94c-1.21,11.18-5.62,22.69-12.21,33.54l11.76,2.72c7.74-13.71,12.4-28.33,12.4-42.4v-5.8s-5.8,0-5.8,0c-27.36,0-56.86,17.48-77.53,41.43l6.7,9.96c17.07-20.83,41.59-36.95,64.68-39.45Z"/>
                  <path fill="#fff" d="M587.16,552.12c-16.72,25.87-45.63,47.34-72.58,50.26,1.66-15.34,9.35-31.32,20.43-45.32l-10.83-4.84c-13.13,17.36-21.54,37.34-21.54,56.31v5.8s5.8,0,5.8,0c31.91,0,66.74-23.77,87.05-53.88l-8.33-8.33Z"/>
                </g>
                <g>
                  <path fill="#fff" d="M484.8,602.38c-11.18-1.21-22.69-5.62-33.54-12.21l-2.72,11.76c13.71,7.74,28.33,12.4,42.4,12.4h5.8s0-5.8,0-5.8c0-27.36-17.48-56.86-41.43-77.53l-9.96,6.7c20.83,17.07,36.95,41.59,39.45,64.68Z"/>
                  <path fill="#fff" d="M448.62,588.52c-25.87-16.72-47.34-45.63-50.26-72.58,15.34,1.66,31.32,9.35,45.32,20.43l4.84-10.83c-17.36-13.13-37.34-21.54-56.31-21.54h-5.8s0,5.8,0,5.8c0,31.91,23.77,66.74,53.88,87.05l8.33-8.33Z"/>
                </g>
              </g>
            </svg>
          </div>
        </div>
      </div>

      {/* Categorías */}
      <div className="px-4 mb-8">
        <div className="flex justify-between overflow-x-auto gap-4 pb-2 scrollbar-hide">
          {CATEGORIES.map(cat => (
            <div key={cat.id} className="flex flex-col items-center min-w-[70px] gap-2 cursor-pointer hover:opacity-80 transition-opacity">
              <div className="w-14 h-14 bg-white shadow-md rounded-2xl flex items-center justify-center text-[#193f3f] border border-[#193f3f]/10">
                {cat.icon}
              </div>
              <span className="text-xs text-center font-medium text-gray-600">{cat.name}</span>
            </div>
          ))}
        </div>
      </div>

      {/* Cerca de ti */}
      <section className="px-4 mb-8">
        <div className="flex justify-between items-end mb-4">
          <h3 className="text-lg font-bold text-gray-800">Cerca de ti</h3>
          <button className="text-[#193f3f] text-xs font-semibold">Ver más</button>
        </div>
        <div className="flex overflow-x-auto gap-4 pb-4 scrollbar-hide">
          {BUSINESSES.map(biz => (
             <div key={biz.id} className="min-w-[160px] bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden flex flex-col h-full" onClick={() => handleBusinessClick(biz)}>
               <div className="h-24 w-full bg-gray-200 relative">
                 <img src={biz.image} className="w-full h-full object-cover" alt={biz.name} />
                 <div className="absolute top-2 right-2 bg-white px-1.5 py-0.5 rounded text-[10px] font-bold shadow flex items-center gap-1">
                    <Star size={8} className="fill-yellow-400 text-yellow-400"/> 4.8
                 </div>
               </div>
               <div className="p-3 flex flex-col">
                 <h4 className="font-bold text-sm text-gray-800 truncate mb-0.5">{biz.name}</h4>
                 <p className="text-[10px] text-[#193f3f] truncate mb-1.5">{biz.specialty}</p>
                 
                 <div>
                   <span className="text-[9px] text-gray-400 font-medium mb-0.5 block">Tiempo de entrega:</span>
                   <div className="flex items-center gap-1.5 bg-gray-100 px-2 py-1.5 rounded-lg w-fit">
                      <Clock size={12} className="text-[#193f3f]" />
                      <span className="text-[10px] font-bold text-gray-600">{biz.deliveryTime}</span>
                   </div>
                 </div>
               </div>
             </div>
          ))}
        </div>
      </section>

      {/* Carrusel de Negocios (Destacado) */}
      <section className="px-4 mb-4">
        <div className="flex justify-between items-end mb-4">
          <h3 className="text-lg font-bold text-gray-800">Los más populares</h3>
          <button className="text-[#193f3f] text-xs font-semibold">Ver más</button>
        </div>
        
        <div className="flex overflow-x-auto gap-4 snap-x snap-mandatory pb-4 scrollbar-hide">
           {BUSINESSES.slice(0,4).map((biz) => (
             <div key={biz.id} className="snap-center min-w-[280px] bg-white rounded-2xl shadow-md overflow-hidden flex flex-col relative border border-gray-100">
                <div className="h-40 w-full bg-gray-200">
                  <img src={biz.image} className="w-full h-full object-cover" alt={biz.name} />
                </div>
                <div className="p-4">
                  <div className="flex justify-between items-start mb-1">
                     <h3 className="font-bold text-lg text-gray-900 leading-tight w-3/4">{biz.name}</h3>
                     <div className="bg-gray-100 p-1 rounded-lg">
                        <img src={biz.logo} className="w-8 h-8 rounded-md object-cover" alt="logo" />
                     </div>
                  </div>
                  
                  <p className="text-xs text-[#193f3f] font-medium mb-3">{biz.specialty}</p>

                  <div className="flex gap-2 mb-4 items-center">
                    <span className="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">{biz.category}</span>
                    <div className="flex items-center gap-1 bg-gray-100 px-2 py-1 rounded text-gray-600">
                       <Clock size={12} className="text-[#193f3f]" />
                       <span className="text-xs font-bold">{biz.deliveryTime}</span>
                    </div>
                  </div>
                  <button 
                    onClick={() => handleBusinessClick(biz)}
                    className="w-full bg-[#193f3f] text-white py-2 rounded-xl font-medium text-sm hover:bg-[#122d2d] transition-colors"
                  >
                    Ver {/* Aquí aplicamos el cambio: "Ver" en vez de "Ver más" solo en el botón de la tarjeta de "Los más populares" */}
                  </button>
                </div>
             </div>
           ))}
        </div>
      </section>
    </div>
  );

  // --- VISTA: TARJETA DE NEGOCIO ---
  const BusinessCardView = () => (
    <div className="bg-gray-50 min-h-screen animate-fadeIn w-full">
      {/* Imagen Grande Superior */}
      <div className="relative h-64 w-full">
        <img src={selectedBusiness.image} alt={selectedBusiness.name} className="w-full h-full object-cover" />
        <button onClick={goBack} className="absolute top-4 left-4 bg-white/90 p-2 rounded-full shadow-lg backdrop-blur-sm">
          <ArrowLeft size={24} className="text-gray-800" />
        </button>
        {/* Logo */}
        <div className="absolute -bottom-8 left-4 bg-white p-1 rounded-2xl shadow-md">
          <img src={selectedBusiness.logo} alt="logo" className="w-16 h-16 rounded-xl object-cover" />
        </div>
      </div>

      {/* Info Contenido Compacto */}
      <div className="pt-10 px-5 pb-20">
        {/* BLOQUE DE INFORMACIÓN: Espaciado reducido al mínimo (gap-0.5) */}
        <div className="flex flex-col gap-0.5 mb-5">
            <h1 className="text-2xl font-bold text-gray-900 leading-tight">{selectedBusiness.name}</h1>
            <p className="text-[#193f3f] font-medium text-sm leading-tight">{selectedBusiness.specialty}</p>
            
            {/* Wrapper para meta info con espaciado mínimo */}
            <div className="flex flex-col gap-0.5 mt-1">
                
                {/* Fila 1: Horario y Estado */}
                <div className="flex items-center text-gray-500 text-xs">
                  <Clock size={14} className="mr-1.5" />
                  <span>{selectedBusiness.hours}</span>
                  <span className="mx-2 text-gray-300">|</span>
                  
                  {(() => {
                     const st = selectedBusiness.status;
                     let color = "text-gray-500";
                     let dot = "bg-gray-400";
                     let label = "";
                     
                     if (st === 'open') {
                       color = "text-green-600";
                       dot = "bg-green-500 shadow-[0_0_6px_rgba(34,197,94,0.5)]";
                       label = "Abierto";
                     } else if (st === 'closing') {
                       color = "text-yellow-600";
                       dot = "bg-yellow-400 shadow-[0_0_6px_rgba(250,204,21,0.5)]";
                       label = "Cierra pronto";
                     } else {
                       color = "text-red-600";
                       dot = "bg-red-500";
                       label = "Cerrado";
                     }

                     return (
                       <div className={`flex items-center gap-1.5 font-bold ${color}`}>
                          <div className={`w-2 h-2 rounded-full ${dot}`}></div>
                          <span>{label}</span>
                       </div>
                     )
                  })()}
                </div>

                {/* Fila 2: Tiempo de Entrega */}
                <div className="flex items-center text-[#193f3f] text-xs font-bold">
                   <Bike size={14} className="mr-1.5" strokeWidth={2.5} />
                   <span>Tiempo de entrega: {selectedBusiness.deliveryTime}</span>
                </div>
            </div>
        </div>

        {/* Indicador de Distancia + COMO LLEGAR (Google Maps) */}
        <div className="bg-white p-3 rounded-xl shadow-sm border border-gray-100 mb-5">
          <div className="flex justify-between items-center mb-2">
             <h3 className="text-xs font-bold text-gray-700">Distancia estimada</h3>
             
             {/* BOTÓN COMO LLEGAR (GOOGLE MAPS) */}
             <button
               onClick={() => openGoogleMaps(selectedBusiness.name)}
               className="flex items-center gap-1 text-[10px] font-bold text-[#193f3f] hover:underline bg-[#193f3f]/5 px-2 py-1 rounded-lg transition-colors"
             >
               <Navigation size={10} className="fill-current" />
               Cómo llegar
             </button>
          </div>
          
          <div className="flex justify-between items-center px-2">
            <div className="flex flex-col items-center gap-0.5">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" className="bi bi-person-walking text-[#193f3f]" viewBox="0 0 16 16">
                <path d="M9.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0M6.44 3.752A.75.75 0 0 1 7 3.5h1.445c.742 0 1.32.643 1.243 1.38l-.43 4.083a1.8 1.8 0 0 1-.088.395l-.318.906.213.242a.8.8 0 0 1 .114.175l2 4.25a.75.75 0 1 1-1.357.638l-1.956-4.154-1.68-1.921A.75.75 0 0 1 6 8.96l.138-2.613-.435.489-.464 2.786a.75.75 0 1 1-1.48-.246l.5-3a.75.75 0 0 1 .18-.375l2-2.25Z"/>
                <path d="M6.25 11.745v-1.418l1.204 1.375.261.524a.8.8 0 0 1-.12.231l-2.5 3.25a.75.75 0 1 1-1.19-.914zm4.22-4.215-.494-.494.205-1.843.006-.067 1.124 1.124h1.44a.75.75 0 0 1 0 1.5H11a.75.75 0 0 1-.531-.22Z"/>
              </svg>
              <span className="text-[10px] font-medium text-gray-600">{selectedBusiness.distances.walk}</span>
            </div>
            <div className="h-6 w-px bg-gray-200"></div>
            <div className="flex flex-col items-center gap-0.5">
              <Bike size={20} className="text-[#193f3f]" />
              <span className="text-[10px] font-medium text-gray-600">{selectedBusiness.distances.bike}</span>
            </div>
            <div className="h-6 w-px bg-gray-200"></div>
            <div className="flex flex-col items-center gap-0.5">
              <Car size={20} className="text-[#193f3f]" />
              <span className="text-[10px] font-medium text-gray-600">{selectedBusiness.distances.car}</span>
            </div>
          </div>
        </div>

        {/* Palabras Clave */}
        <div className="flex gap-2 mb-6">
          {selectedBusiness.keywords.map((kw, idx) => (
            <span key={idx} className="px-2.5 py-0.5 bg-[#193f3f]/10 text-[#193f3f] text-[10px] rounded-full font-medium border border-[#193f3f]/20">
              {kw}
            </span>
          ))}
        </div>

        {/* CAMBIO: Galería de Fotos ÚNICA (antes duplicada) - Sin título */}
        <div className="mb-6">
           <div className="grid grid-cols-3 gap-2">
             {selectedBusiness.gallery && selectedBusiness.gallery.length > 0 ? (
               selectedBusiness.gallery.map((imgUrl, idx) => (
                 <div key={idx} className="group relative rounded-lg overflow-hidden shadow-sm border border-gray-100 aspect-square bg-gray-200">
                    <img 
                       src={imgUrl} 
                       alt={`Foto ${idx + 1}`} 
                       className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                    />
                    <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors" />
                 </div>
               ))
             ) : (
               <div className="col-span-3 text-center py-4 text-gray-400 text-xs">No hay fotos disponibles.</div>
             )}
           </div>
        </div>

        {/* Botones de Acción (Solo WhatsApp ahora) */}
        <div className="space-y-3 mb-6">
          <button className="w-full bg-[#25D366] text-white font-bold py-3.5 rounded-2xl flex items-center justify-center gap-2 shadow-md hover:bg-[#20bd5a] transition-colors">
            <MessageCircle size={20} />
            Contactar por WhatsApp
          </button>
        </div>
      </div>
    </div>
  );

  // --- VISTA: RESTAURANTE / GALERÍA ---
  const RestaurantView = () => (
    <div className="bg-gray-50 min-h-screen flex flex-col animate-fadeIn w-full">
      {/* Top bar */}
      <div className="bg-white p-4 sticky top-0 z-20 shadow-sm flex items-center gap-3">
        <button onClick={goBack} className="p-2 hover:bg-gray-100 rounded-full">
          <ArrowLeft size={20} className="text-gray-700" />
        </button>
        <div className="flex-1 relative">
           <Search className="absolute left-3 top-2.5 text-gray-400 w-4 h-4" />
           <input 
             type="text" 
             placeholder={`Buscar en ${selectedBusiness.name}...`}
             className="w-full bg-gray-100 py-2 pl-9 pr-4 rounded-xl text-sm outline-none focus:ring-1 focus:ring-[#193f3f]"
           />
        </div>
      </div>

      <div className="p-4 flex-1 pb-24">
        <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6">
          <p className="text-gray-600 text-sm leading-relaxed">
            {selectedBusiness.description}
          </p>
        </div>

        <div className="flex items-center gap-2 mb-4">
           <ImageIcon size={20} className="text-[#193f3f]" />
           <h3 className="text-lg font-bold text-gray-800">Galería</h3>
        </div>
        
        <div className="grid grid-cols-2 gap-3">
          {selectedBusiness.gallery && selectedBusiness.gallery.length > 0 ? (
            selectedBusiness.gallery.map((imgUrl, idx) => (
              <div key={idx} className="group relative rounded-2xl overflow-hidden shadow-sm border border-gray-100 aspect-square bg-gray-200">
                 <img 
                    src={imgUrl} 
                    alt={`Foto ${idx + 1}`} 
                    className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                 />
                 <div className="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors" />
              </div>
            ))
          ) : (
            <div className="col-span-2 text-center py-10 text-gray-400">No hay fotos disponibles.</div>
          )}
        </div>
      </div>
    </div>
  );

  // --- RENDER PRINCIPAL ---
  return (
    <div className="font-poppins bg-gray-50 min-h-screen max-w-md mx-auto shadow-2xl border-x border-gray-200 overflow-hidden relative text-gray-800">
      {currentView === 'home' && <HomeView />}
      {currentView === 'card' && <BusinessCardView />}
      {currentView === 'restaurant' && <RestaurantView />}
    </div>
  );
}